function getReferencias(){FBRef=new Firebase(myFB),usuariosRef=FBRef.child("usuarios"),chaptersRef=FBRef.child("chapters"),connectedRef=FBRef.child(".info/connected")}function goAuth(){AuthRef=new Firebase(myFB),auth=new FirebaseSimpleLogin(AuthRef,function(a,b){a?console.log(a):b?(usuario=b,auth.createUser(getEmail(usuario.username),"123456",function(a){a?fillScreen():newUser(b.id,b.displayName,getEmail(usuario.username))})):logoutstatus()})}function login(){auth.login("github",{rememberMe:!0,scope:"user"})}function logout(){auth.logout(),usuario=!1,chapters=!1,logoutstatus()}function logoutstatus(){var a=$("#auth_wrapper");a.attr("data-id",""),a.attr("data-nombre",""),a.attr("data-email",""),$("#mifoto").add("#exercise").slideUp(function(){$("#loggedout").fadeIn(),$("#mifoto").attr("src","")})}function presencia(a){connectedRef.on("value",function(b){b.val()===!0&&(a.onDisconnect().set(Firebase.ServerValue.TIMESTAMP),a.set(!0))})}function fillScreen(){rellenaDatosUsuario(),getChapters()}function getChapters(){chaptersRef.on("value",function(a){chapters=a.val()})}function newUser(a,b,c){userRef=usuariosRef.child(a),userRef.set({id:a,nombre:b,email:c,foto:getFotoUrl(a)},function(){fillScreen()})}function rellenaDatosUsuario(){usuario?(userRef||(userRef=usuariosRef.child(usuario.id)),userRef.once("value",function(a){if(null===a.val())logout();else{var b=a.val().nombre,c=a.val().email,d=a.val().foto,e=$("#auth_wrapper");e.attr("data-id",usuario.id),e.attr("data-nombre",b),e.attr("data-email",c),$("#mifoto").attr("src",d),$("#mifoto").slideDown(),$("#loggedout").slideUp(function(){$("#exercise").fadeIn()});var f=userRef.child("online");presencia(f)}})):logoutstatus()}function activeExercicesButton(){var a=$(".nav span");a.click(function(){var a=$(this).attr("data-chapter"),b=$(this).attr("data-exercise");usuario?drawExercise(a,b):(anima($(this),"shake"),anima($("#loggedout"),"tada"))})}function drawExercise(a,b){if(chapters)if(void 0!=chapters[a].exercises[b]){$("#transitory").is(":visible")&&$("#transitory").slideUp();var c=chapters[a].exercises[b],d=$("#current");d.slideUp(function(){d.empty();var e=$("<div></div>").attr({"class":"col-sm-12"});$("#current").append(e);var f=$("<div></div>").attr({"class":"page-header text-muted"}).text("exercise "+a+"."+b);e.append(f);var g=$("<div></div>").attr({"class":"enunciado"}).html(c.text);if(e.append(g),c.solutions){var h=$("<div></div>").attr({"class":"col-sm-12"});$("#current").append(h);var f=$("<div></div>").attr({"class":"page-header text-muted"}).text("Solutions");h.append(f);var i=$("<div></div>").attr({id:"solutions"});h.append(i),$.each(c.solutions,function(c,d){drawSolution(c,d,a,b)})}var j=$("<div></div>").attr({"class":"col-sm-12"});$("#current").append(j);var f=$("<div></div>").attr({"class":"page-header text-muted"}).text("NEW SOLUTION");j.append(f);var k=$("<div></div>").attr({"class":"newsolutionwrapper"});j.append(k);var l=$("<textarea></textarea>").attr({id:"newsolution","data-chapter":a,"data-exercise":b});k.append(l);var m=$("<button></button>").attr({clas:"btn btn-default"}).text("Send new solution");k.append(m),m.click(function(){writeSolution()}),d.slideDown()})}else console.log("Exercise not found");else console.log("Exercises not loaded")}function writeSolution(){var a=$("#newsolution"),b=a.attr("data-chapter"),c=a.attr("data-exercise"),d=a.val(),e=new Date,f=e.getTime(),g=chaptersRef.child(b+"/exercises/"+c+"/solutions"),h=g.push();h.set({author:usuario.displayName,date:f,pic:getFotoUrl(usuario.id),username:usuario.username,text:marked(d)},function(){drawExercise(b,c)})}function drawExerciseEdit(a,b){if(chapters){$("#transitory").is(":visible")&&$("#transitory").slideUp();var c=$("#current");c.slideUp(function(){c.empty();var d=$("<div></div>").attr({"class":"col-sm-12"});$("#current").append(d);var e=$("<div></div>").attr({"class":"page-header text-muted"}).text("exercise "+a+"."+b);d.append(e);var f=$("<textarea></textarea>").css({width:"100%",height:"200px"}).attr({id:"textarea","data-chapter":a,"data-exercise":b});d.append(f);var g=$("<button></button>").attr({clas:"btn btn-default"}).text("Send");d.append(g),g.click(function(){writeExercise()}),c.slideDown()})}else console.log("Exercises not loaded")}function drawSolution(a,b,c,d){var e=when(b.date),f=$("<div></div>").attr({"class":"row solution"});$("#solutions").append(f);var g=$("<div></div>").attr({"class":"col-sm-12"});f.append(g);var h=$("<img>").attr({src:b.pic,"class":"img-circle avatar pull-left"});g.append(h);var i=$("<h3></h3>").text(b.author);g.append(i);var j=$("<div></div>").attr({"class":"div_delete pull-right"}).html('<span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-trash fa-stack-1x fa-inverse"></i></span>').hide();g.append(j);var k=$("<h4></h4>");g.append(k);var l=$("<span></span>").attr({"class":"label label-default"}).text("github.com/"+b.username);k.append(l);var m=$("<small></small>").attr({"class":"text-muted"}).html("&nbsp;&nbsp; "+e);k.append(m);var n=$("<pre></pre>");g.append(n);var o=$("<code></code>").html(b.text);n.append(o);var p=$("<hr>");g.append(p),b.username==usuario.username&&j.show().click(function(){deleteSolution(a,c,d)})}function writeExercise(){var a=$("#textarea"),b=a.attr("data-chapter"),c=a.attr("data-exercise"),d=a.val();exerciseRef=chaptersRef.child(b+"/exercises/"+c),exerciseRef.set({text:marked(d)},function(){drawExercise(b,c)})}function deleteSolution(a,b,c){var d=chaptersRef.child(b+"/exercises/"+c+"/solutions/"+a);d.remove(),drawExercise(b,c)}function getEmail(a){return a+"@47deg.com"}function getFotoUrl(a){return"https://avatars3.githubusercontent.com/u/"+a+"?s=140"}function anima(a,b,c){a.addClass("animated").addClass(b);window.setTimeout(function(){a.removeClass("animated").removeClass(b),"function"==typeof c&&setTimeout(function(){c()},10)},1300)}function when(a){var b="--",c=(new Date(a),new Date),d=c.getTime(),e=d-a,f=Math.floor(e/6e4);return b=2>f?"Just added":15>f?"A moment ago":60>f?"Half hour ago":120>f?"A hour ago":1440>f?Math.floor(f/60)+" hours ago":2880>f?"A day ago":Math.floor(f/1440)+" days ago"}$(document).ready(function(){$.ajaxSetup({cache:!1}),$.when($("head").append('<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" type="text/css" />'),$.ready.promise()).then(function(){getReferencias(),goAuth(),activeExercicesButton()})});var myFB="https://scala-exercises.firebaseio.com",FBRef,usuariosRef,connectedRef,userRef=!1,usuario=!1,auth=!1,chapters=!1;